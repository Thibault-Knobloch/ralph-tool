services:
  ai:
    build:
      context: .
      dockerfile: Dockerfile
    working_dir: /workspace
    environment:
      - TERM=xterm-256color
      - CLAUDE_CONFIG_DIR=/home/node/.config/claude
      - SSH_AUTH_SOCK=/run/host-services/ssh-auth.sock
      - RALPH_HOME=/ralph-tool
      - GIT_USER_NAME=${GIT_USER_NAME:-}
      - GIT_USER_EMAIL=${GIT_USER_EMAIL:-}
    volumes:
      # Project directory mounted to /workspace (set by ralph CLI)
      # This is handled dynamically by the start.sh script

      # Ralph tool installation
      - .:/ralph-tool:ro

      # Persistent volumes for configs
      - claude_config:/home/node/.config/claude
      - claude_workspace:/workspace/.claude
      - gh_config:/home/node/.config/gh

      # SSH agent for git operations
      - type: bind
        source: /run/host-services/ssh-auth.sock
        target: /run/host-services/ssh-auth.sock

      # Git config (read-only)
      - ~/.gitconfig:/home/node/.gitconfig:ro

    stdin_open: true
    tty: true

volumes:
  claude_config:
  claude_workspace:
  gh_config:
